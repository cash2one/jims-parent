<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jims.clinic.dao.PatVisitDao">
    
	<sql id="patVisitColumns">
		a.id AS "id",
		a.visit_id AS "visitId",
		a.patient_id AS "patientId",
		a.dept_admission_to AS "deptAdmissionTo",
		a.admission_date_time AS "admissionDateTime",
		a.dept_discharge_from AS "deptDischargeFrom",
		a.discharge_date_time AS "dischargeDateTime",
		a.occupation AS "occupation",
		a.marital_status AS "maritalStatus",
		a.identity AS "identity",
		a.armed_services AS "armedServices",
		a.duty AS "duty",
		a.top_unit AS "topUnit",
		a.service_system_indicator AS "serviceSystemIndicator",
		a.unit_in_contract AS "unitInContract",
		a.charge_type AS "chargeType",
		a.working_status AS "workingStatus",
		a.insurance_type AS "insuranceType",
		a.insurance_no AS "insuranceNo",
		a.service_agency AS "serviceAgency",
		a.mailing_address AS "mailingAddress",
		a.zip_code AS "zipCode",
		a.next_of_kin AS "nextOfKin",
		a.relationship AS "relationship",
		a.next_of_kin_addr AS "nextOfKinAddr",
		a.next_of_kin_zipcode AS "nextOfKinZipcode",
		a.next_of_kin_phone AS "nextOfKinPhone",
		a.patient_class AS "patientClass",
		a.admission_cause AS "admissionCause",
		a.consulting_date AS "consultingDate",
		a.pat_adm_condition AS "patAdmCondition",
		a.consulting_doctor AS "consultingDoctor",
		a.admitted_by AS "admittedBy",
		a.emer_treat_times AS "emerTreatTimes",
		a.esc_emer_times AS "escEmerTimes",
		a.serious_cond_days AS "seriousCondDays",
		a.critical_cond_days AS "criticalCondDays",
		a.icu_days AS "icuDays",
		a.ccu_days AS "ccuDays",
		a.spec_level_nurs_days AS "specLevelNursDays",
		a.first_level_nurs_days AS "firstLevelNursDays",
		a.second_level_nurs_days AS "secondLevelNursDays",
		a.autopsy_indicator AS "autopsyIndicator",
		a.blood_type AS "bloodType",
		a.blood_type_rh AS "bloodTypeRh",
		a.infusion_react_times AS "infusionReactTimes",
		a.blood_tran_times AS "bloodTranTimes",
		a.blood_tran_vol AS "bloodTranVol",
		a.blood_tran_react_times AS "bloodTranReactTimes",
		a.decubital_ulcer_times AS "decubitalUlcerTimes",
		a.alergy_drugs AS "alergyDrugs",
		a.adverse_reaction_drugs AS "adverseReactionDrugs",
		a.mr_value AS "mrValue",
		a.mr_quality AS "mrQuality",
		a.follow_indicator AS "followIndicator",
		a.follow_interval AS "followInterval",
		a.follow_interval_units AS "followIntervalUnits",
		a.director AS "director",
		a.attending_doctor AS "attendingDoctor",
		a.doctor_in_charge AS "doctorInCharge",
		a.discharge_disposition AS "dischargeDisposition",
		a.total_costs AS "totalCosts",
		a.total_payments AS "totalPayments",
		a.catalog_date AS "catalogDate",
		a.cataloger AS "cataloger",
		a.hbsag_indicator AS "hbsagIndicator",
		a.hcv_ab_indicator AS "hcvAbIndicator",
		a.hiv_ab_indicator AS "hivAbIndicator",
		a.chief_doctor AS "chiefDoctor",
		a.advanced_studies_doctor AS "advancedStudiesDoctor",
		a.practice_doctor_of_graduate AS "practiceDoctorOfGraduate",
		a.practice_doctor AS "practiceDoctor",
		a.doctor_of_control_quality AS "doctorOfControlQuality",
		a.nurse_of_control_quality AS "nurseOfControlQuality",
		a.date_of_control_quality AS "dateOfControlQuality",
		a.first_case_indicator AS "firstCaseIndicator",
		a.third_level_nurs_days AS "thirdLevelNursDays",
		a.x_exam_no AS "xExamNo",
		a.treated_in_others_indicator AS "treatedInOthersIndicator",
		a.treat_method AS "treatMethod",
		a.hosp_made_medicine_indicator AS "hospMadeMedicineIndicator",
		a.pathology_no AS "pathologyNo",
		a.upper_doctor_guide_effect AS "upperDoctorGuideEffect",
		a.emer_treat_method AS "emerTreatMethod",
		a.ictus_indicator AS "ictusIndicator",
		a.difficulty_indicator AS "difficultyIndicator",
		a.from_other_place_indicator AS "fromOtherPlaceIndicator",
		a.suspicion_indicator AS "suspicionIndicator",
		a.chinese_medicine_indicator AS "chineseMedicineIndicator",
		a.operation_scale AS "operationScale",
		a.diagnosis_correctness AS "diagnosisCorrectness",
		a.treat_method_correctness AS "treatMethodCorrectness",
		a.prescription_correctness AS "prescriptionCorrectness",
		a.mr_complete_indicator AS "mrCompleteIndicator",
		a.medical_term_correctness AS "medicalTermCorrectness",
		a.pper_doctor_guide_effect AS "pperDoctorGuideEffect",
		a.treat_method_judgement AS "treatMethodJudgement",
		a.duty_nurse AS "dutyNurse",
		a.death_reason AS "deathReason",
		a.death_date_time AS "deathDateTime",
		a.science_research_indicator AS "scienceResearchIndicator",
		a.first_operation_indicator AS "firstOperationIndicator",
		a.first_treatment_indicator AS "firstTreatmentIndicator",
		a.first_examination_indicator AS "firstExaminationIndicator",
		a.first_diagnosis_indicator AS "firstDiagnosisIndicator",
		a.infusion_react_indicator AS "infusionReactIndicator",
		a.serious_indicator AS "seriousIndicator",
		a.adt_room_no AS "adtRoomNo",
		a.ddt_room_no AS "ddtRoomNo",
		a.infect_indicator AS "infectIndicator",
		a.health_level AS "healthLevel",
		a.mr_infect_report AS "mrInfectReport",
		a.newborn AS "newborn",
		a.third_level_nurse_days AS "thirdLevelNurseDays",
		a.insurance_aera AS "insuranceAera",
		a.body_weight AS "bodyWeight",
		a.body_height AS "bodyHeight",
		a.business_zip_code AS "businessZipCode",
		a.infusion_tran_times AS "infusionTranTimes",
		a.change_indicator AS "changeIndicator",
		a.docum_date AS "documDate",
		a.docum_days AS "documDays",
		a.docum_person AS "documPerson",
		a.zymosis_indicator AS "zymosisIndicator",
		a.zymosis_date AS "zymosisDate",
		a.breath_mach_times AS "breathMachTimes",
		a.coma_times_b1 AS "comaTimesB1",
		a.coma_times_b2 AS "comaTimesB2",
		a.coma_times_a1 AS "comaTimesA1",
		a.coma_times_a2 AS "comaTimesA2",
		a.trans_hospital AS "transHospital",
		a.trans_community AS "transCommunity",
		a.phone_number_business AS "phoneNumberBusiness",
		a.mr_binder AS "mrBinder",
		a.carry_person_number AS "carryPersonNumber",
		a.change_operator AS "changeOperator",
		a.discharge_bed_no AS "dischargeBedNo",
		a.discharge_ward_code AS "dischargeWardCode",
		a.inp_serial_no AS "inpSerialNo",
		a.nhzyh AS "nhzyh",
		a.ff_xsdm AS "ffXsdm",
		a.trans_flag AS "transFlag",
		a.gz_flag AS "gzFlag",
		a.visit_date AS "visitDate",
		a.visit_no AS "visitNo",
		a.phone_number_home AS "phoneNumberHome",
		a.patient_area AS "patientArea",
		a.catalog_status AS "catalogStatus",
		a.locked_date AS "lockedDate",
		a.diagnose_date AS "diagnoseDate",
		a.medical_pay_way AS "medicalPayWay",
		a.statistics_diagnose_date AS "statisticsDiagnoseDate",
		a.docum_flag AS "documFlag",
		a.statistics_flag AS "statisticsFlag",
		a.weight_birth AS "weightBirth",
		a.coma_times_b0 AS "comaTimesB0",
		a.coma_times_a0 AS "comaTimesA0",
		a.patient_area_address AS "patientAreaAddress",
		a.pat_street_address AS "patStreetAddress",
		a.pat_phone AS "patPhone",
		a.pat_zip AS "patZip",
		a.plan_31_admission AS "plan31Admission",
		a.reason_31_admission AS "reason31Admission",
		a.tumor_t AS "tumorT",
		a.tumor_n AS "tumorN",
		a.tumor_m AS "tumorM",
		a.tumor_stage AS "tumorStage",
		a.adl_adm AS "adlAdm",
		a.adl_dis AS "adlDis",
		a.basis_on AS "basisOn",
		a.diff_id AS "diffId",
		a.locked_user AS "lockedUser",
		a.inp_no AS "inpNo",
		a.return_indicator AS "returnIndicator",
		a.pat_charge_type AS "patChargeType",
		a.operator AS "operator",
		a.enter_date AS "enterDate",
		a.parity_no AS "parityNo",
		a.onset_date AS "onsetDate",
		a.nh_serial_no AS "nhSerialNo",
		a.ip AS "ip",
		a.regist_attr AS "registAttr",
		a.visit_type AS "visitType",
		a.antibiotics_used AS "antibioticsUsed",
		a.antibiotics_count AS "antibioticsCount",
		a.antibiotics_union AS "antibioticsUnion",
		a.germiculture_drug_test AS "germicultureDrugTest",
		a.infectious_disease_report AS "infectiousDiseaseReport",
		a.blood_tran_flag AS "bloodTranFlag",
		a.drgs AS "drgs",
		a.admission_bed_no AS "admissionBedNo",
		a.newborn_inh_body_weight AS "newbornInhBodyWeight",
		a.newborn_body_weight AS "newbornBodyWeight",
		a.pof_flag AS "pofFlag",
		a.clinical_pathway AS "clinicalPathway",
		a.chinese_med_equipment AS "chineseMedEquipment",
		a.chinese_med_technology AS "chineseMedTechnology",
		a.dialectical_nursing AS "dialecticalNursing",
		a.yb_inp AS "ybInp",
		a.nhzz_type AS "nhzzType",
		a.create_by AS "createBy.id",
		a.create_date AS "createDate",
		a.update_by AS "updateBy.id",
		a.update_date AS "updateDate",
		a.remarks AS "remarks",
		a.del_flag AS "delFlag"
	</sql>
	<sql id="getMaster">
		b.id AS "Master.id",
		b.inp_no AS "Master.inpNo",
		b.name AS "Master.name",
		b.name_phonetic AS "Master.namePhonetic",
		b.sex AS "Master.sex",
		b.date_of_birth AS "Master.dateOfBirth",
		b.birth_place AS "Master.birthPlace",
		b.citizenship AS "Master.citizenship",
		b.nation AS "Master.nation",
		b.id_no AS "Master.idNo",
		b.identity AS "Master.identity",
		b.charge_type AS "Master.chargeType",
		b.unit_in_contract AS "Master.unitInContract",
		b.mailing_address AS "Master.mailingAddress",
		b.zip_code AS "Master.zipCode",
		b.phone_number_home AS "Master.phoneNumberHome",
		b.phone_number_business AS "Master.phoneNumberBusiness",
		b.next_of_kin AS "Master.nextOfKin",
		b.relationship AS "Master.relationship",
		b.next_of_kin_addr AS "Master.nextOfKinAddr",
		b.next_of_kin_zip_code AS "Master.nextOfKinZipCode",
		b.next_of_kin_phone AS "Master.nextOfKinPhone",
		b.last_visit_date AS "Master.lastVisitDate",
		b.vip_indicator AS "Master.vipIndicator",
		b.create_date AS "Master.createDate",
		b.operator AS "Master.operator",
		b.service_agency AS "Master.serviceAgency",
		b.business_zip_code AS "Master.businessZipCode",
		b.photo AS "Master.photo",
		b.patient_class AS "Master.patientClass",
		b.degree AS "Master.degree",
		b.race AS "Master.race",
		b.religion AS "Master.religion",
		b.mother_language AS "Master.motherLanguage",
		b.foreign_language AS "Master.foreignLanguage",
		b.id_type AS "Master.idType",
		b.vip_no AS "Master.vipNo",
		b.e_name AS "Master.eName",
		b.occupation AS "Master.occupation",
		b.next_of_id AS "Master.nextOfId",
		b.next_of_bath AS "Master.nextOfBath",
		b.next_of_sex AS "Master.nextOfSex",
		b.insur_nh_no AS "Master.insurNhNo",
		b.insurance_no AS "Master.insuranceNo",
		b.alergy_drugs AS "Master.alergyDrugs",
		b.native_place AS "Master.nativePlace",
		b.mailing_address_code AS "Master.mailingAddressCode",
		b.healthy_card_no AS "Master.healthyCardNo",
		b.address_now AS "Master.addressNow",
		b.patient_id AS "Master.patientId"
	</sql>
	<sql id="patVisitJoins">
		pat_master_index b left join  pat_visit a on a.patient_id =b.patient_id
	</sql>
    
	<select id="get" resultType="PatVisit">
		SELECT 
			<include refid="patVisitColumns"/>
		FROM pat_visit a
		<include refid="patVisitJoins"/>
		WHERE a.id = #{id}
	</select>
	<select id="getPatVisit" resultType="PatVisit">
		SELECT
		<include refid="patVisitColumns"/>
		FROM pat_visit a

		WHERE a.patient_id = #{patientId}
	</select>
	<select id="findList" resultType="PatVisit">
		SELECT 
			<include refid="patVisitColumns"/>
		FROM pat_visit a
		<include refid="patVisitJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
		</where>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>
	
	<select id="findAllList" resultType="PatVisit">
		SELECT 
			<include refid="patVisitColumns"/>
		FROM pat_visit a
		<include refid="patVisitJoins"/>
		<where>
			a.del_flag = #{DEL_FLAG_NORMAL}
		</where>		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
				ORDER BY a.update_date DESC
			</otherwise>
		</choose>
	</select>
	
	<insert id="insert">
		INSERT INTO pat_visit(
			id,
			patient_id,
			visit_id,
			dept_admission_to,
			admission_date_time,
			dept_discharge_from,
			discharge_date_time,
			occupation,
			marital_status,
			identity,
			armed_services,
			duty,
			top_unit,
			service_system_indicator,
			unit_in_contract,
			charge_type,
			working_status,
			insurance_type,
			insurance_no,
			service_agency,
			mailing_address,
			zip_code,
			next_of_kin,
			relationship,
			next_of_kin_addr,
			next_of_kin_zipcode,
			next_of_kin_phone,
			patient_class,
			admission_cause,
			consulting_date,
			pat_adm_condition,
			consulting_doctor,
			admitted_by,
			emer_treat_times,
			esc_emer_times,
			serious_cond_days,
			critical_cond_days,
			icu_days,
			ccu_days,
			spec_level_nurs_days,
			first_level_nurs_days,
			second_level_nurs_days,
			autopsy_indicator,
			blood_type,
			blood_type_rh,
			infusion_react_times,
			blood_tran_times,
			blood_tran_vol,
			blood_tran_react_times,
			decubital_ulcer_times,
			alergy_drugs,
			adverse_reaction_drugs,
			mr_value,
			mr_quality,
			follow_indicator,
			follow_interval,
			follow_interval_units,
			director,
			attending_doctor,
			doctor_in_charge,
			discharge_disposition,
			total_costs,
			total_payments,
			catalog_date,
			cataloger,
			hbsag_indicator,
			hcv_ab_indicator,
			hiv_ab_indicator,
			chief_doctor,
			advanced_studies_doctor,
			practice_doctor_of_graduate,
			practice_doctor,
			doctor_of_control_quality,
			nurse_of_control_quality,
			date_of_control_quality,
			first_case_indicator,
			third_level_nurs_days,
			x_exam_no,
			treated_in_others_indicator,
			treat_method,
			hosp_made_medicine_indicator,
			pathology_no,
			upper_doctor_guide_effect,
			emer_treat_method,
			ictus_indicator,
			difficulty_indicator,
			from_other_place_indicator,
			suspicion_indicator,
			chinese_medicine_indicator,
			operation_scale,
			diagnosis_correctness,
			treat_method_correctness,
			prescription_correctness,
			mr_complete_indicator,
			medical_term_correctness,
			pper_doctor_guide_effect,
			treat_method_judgement,
			duty_nurse,
			death_reason,
			death_date_time,
			science_research_indicator,
			first_operation_indicator,
			first_treatment_indicator,
			first_examination_indicator,
			first_diagnosis_indicator,
			infusion_react_indicator,
			serious_indicator,
			adt_room_no,
			ddt_room_no,
			infect_indicator,
			health_level,
			mr_infect_report,
			newborn,
			third_level_nurse_days,
			insurance_aera,
			body_weight,
			body_height,
			business_zip_code,
			infusion_tran_times,
			change_indicator,
			docum_date,
			docum_days,
			docum_person,
			zymosis_indicator,
			zymosis_date,
			breath_mach_times,
			coma_times_b1,
			coma_times_b2,
			coma_times_a1,
			coma_times_a2,
			trans_hospital,
			trans_community,
			phone_number_business,
			mr_binder,
			carry_person_number,
			change_operator,
			discharge_bed_no,
			discharge_ward_code,
			inp_serial_no,
			nhzyh,
			ff_xsdm,
			trans_flag,
			gz_flag,
			visit_date,
			visit_no,
			phone_number_home,
			patient_area,
			catalog_status,
			locked_date,
			diagnose_date,
			medical_pay_way,
			statistics_diagnose_date,
			docum_flag,
			statistics_flag,
			weight_birth,
			coma_times_b0,
			coma_times_a0,
			patient_area_address,
			pat_street_address,
			pat_phone,
			pat_zip,
			plan_31_admission,
			reason_31_admission,
			tumor_t,
			tumor_n,
			tumor_m,
			tumor_stage,
			adl_adm,
			adl_dis,
			basis_on,
			diff_id,
			locked_user,
			inp_no,
			return_indicator,
			pat_charge_type,
			operator,
			enter_date,
			parity_no,
			onset_date,
			nh_serial_no,
			ip,
			regist_attr,
			visit_type,
			antibiotics_used,
			antibiotics_count,
			antibiotics_union,
			germiculture_drug_test,
			infectious_disease_report,
			blood_tran_flag,
			drgs,
			admission_bed_no,
			newborn_inh_body_weight,
			newborn_body_weight,
			pof_flag,
			clinical_pathway,
			chinese_med_equipment,
			chinese_med_technology,
			dialectical_nursing,
			yb_inp,
			nhzz_type,
			create_by,
			create_date,
			update_by,
			update_date,
			remarks,
			del_flag
		) VALUES (
			#{id},
			#{patientId},
			#{visitId},
			#{deptAdmissionTo},
			#{admissionDateTime},
			#{deptDischargeFrom},
			#{dischargeDateTime},
			#{occupation},
			#{maritalStatus},
			#{identity},
			#{armedServices},
			#{duty},
			#{topUnit},
			#{serviceSystemIndicator},
			#{unitInContract},
			#{chargeType},
			#{workingStatus},
			#{insuranceType},
			#{insuranceNo},
			#{serviceAgency},
			#{mailingAddress},
			#{zipCode},
			#{nextOfKin},
			#{relationship},
			#{nextOfKinAddr},
			#{nextOfKinZipcode},
			#{nextOfKinPhone},
			#{patientClass},
			#{admissionCause},
			#{consultingDate},
			#{patAdmCondition},
			#{consultingDoctor},
			#{admittedBy},
			#{emerTreatTimes},
			#{escEmerTimes},
			#{seriousCondDays},
			#{criticalCondDays},
			#{icuDays},
			#{ccuDays},
			#{specLevelNursDays},
			#{firstLevelNursDays},
			#{secondLevelNursDays},
			#{autopsyIndicator},
			#{bloodType},
			#{bloodTypeRh},
			#{infusionReactTimes},
			#{bloodTranTimes},
			#{bloodTranVol},
			#{bloodTranReactTimes},
			#{decubitalUlcerTimes},
			#{alergyDrugs},
			#{adverseReactionDrugs},
			#{mrValue},
			#{mrQuality},
			#{followIndicator},
			#{followInterval},
			#{followIntervalUnits},
			#{director},
			#{attendingDoctor},
			#{doctorInCharge},
			#{dischargeDisposition},
			#{totalCosts},
			#{totalPayments},
			#{catalogDate},
			#{cataloger},
			#{hbsagIndicator},
			#{hcvAbIndicator},
			#{hivAbIndicator},
			#{chiefDoctor},
			#{advancedStudiesDoctor},
			#{practiceDoctorOfGraduate},
			#{practiceDoctor},
			#{doctorOfControlQuality},
			#{nurseOfControlQuality},
			#{dateOfControlQuality},
			#{firstCaseIndicator},
			#{thirdLevelNursDays},
			#{xExamNo},
			#{treatedInOthersIndicator},
			#{treatMethod},
			#{hospMadeMedicineIndicator},
			#{pathologyNo},
			#{upperDoctorGuideEffect},
			#{emerTreatMethod},
			#{ictusIndicator},
			#{difficultyIndicator},
			#{fromOtherPlaceIndicator},
			#{suspicionIndicator},
			#{chineseMedicineIndicator},
			#{operationScale},
			#{diagnosisCorrectness},
			#{treatMethodCorrectness},
			#{prescriptionCorrectness},
			#{mrCompleteIndicator},
			#{medicalTermCorrectness},
			#{pperDoctorGuideEffect},
			#{treatMethodJudgement},
			#{dutyNurse},
			#{deathReason},
			#{deathDateTime},
			#{scienceResearchIndicator},
			#{firstOperationIndicator},
			#{firstTreatmentIndicator},
			#{firstExaminationIndicator},
			#{firstDiagnosisIndicator},
			#{infusionReactIndicator},
			#{seriousIndicator},
			#{adtRoomNo},
			#{ddtRoomNo},
			#{infectIndicator},
			#{healthLevel},
			#{mrInfectReport},
			#{newborn},
			#{thirdLevelNurseDays},
			#{insuranceAera},
			#{bodyWeight},
			#{bodyHeight},
			#{businessZipCode},
			#{infusionTranTimes},
			#{changeIndicator},
			#{documDate},
			#{documDays},
			#{documPerson},
			#{zymosisIndicator},
			#{zymosisDate},
			#{breathMachTimes},
			#{comaTimesB1},
			#{comaTimesB2},
			#{comaTimesA1},
			#{comaTimesA2},
			#{transHospital},
			#{transCommunity},
			#{phoneNumberBusiness},
			#{mrBinder},
			#{carryPersonNumber},
			#{changeOperator},
			#{dischargeBedNo},
			#{dischargeWardCode},
			#{inpSerialNo},
			#{nhzyh},
			#{ffXsdm},
			#{transFlag},
			#{gzFlag},
			#{visitDate},
			#{visitNo},
			#{phoneNumberHome},
			#{patientArea},
			#{catalogStatus},
			#{lockedDate},
			#{diagnoseDate},
			#{medicalPayWay},
			#{statisticsDiagnoseDate},
			#{documFlag},
			#{statisticsFlag},
			#{weightBirth},
			#{comaTimesB0},
			#{comaTimesA0},
			#{patientAreaAddress},
			#{patStreetAddress},
			#{patPhone},
			#{patZip},
			#{plan31Admission},
			#{reason31Admission},
			#{tumorT},
			#{tumorN},
			#{tumorM},
			#{tumorStage},
			#{adlAdm},
			#{adlDis},
			#{basisOn},
			#{diffId},
			#{lockedUser},
			#{inpNo},
			#{returnIndicator},
			#{patChargeType},
			#{operator},
			#{enterDate},
			#{parityNo},
			#{onsetDate},
			#{nhSerialNo},
			#{ip},
			#{registAttr},
			#{visitType},
			#{antibioticsUsed},
			#{antibioticsCount},
			#{antibioticsUnion},
			#{germicultureDrugTest},
			#{infectiousDiseaseReport},
			#{bloodTranFlag},
			#{drgs},
			#{admissionBedNo},
			#{newbornInhBodyWeight},
			#{newbornBodyWeight},
			#{pofFlag},
			#{clinicalPathway},
			#{chineseMedEquipment},
			#{chineseMedTechnology},
			#{dialecticalNursing},
			#{ybInp},
			#{nhzzType},
			#{createBy.id},
			#{createDate},
			#{updateBy.id},
			#{updateDate},
			#{remarks},
			#{delFlag}
		)
	</insert>
	
	<update id="update">
		UPDATE pat_visit SET
			patient_id= #{patientId},
			visit_id = #{visitId},
			dept_admission_to = #{deptAdmissionTo},
			admission_date_time = #{admissionDateTime},
			dept_discharge_from = #{deptDischargeFrom},
			discharge_date_time = #{dischargeDateTime},
			occupation = #{occupation},
			marital_status = #{maritalStatus},
			identity = #{identity},
			armed_services = #{armedServices},
			duty = #{duty},
			top_unit = #{topUnit},
			service_system_indicator = #{serviceSystemIndicator},
			unit_in_contract = #{unitInContract},
			charge_type = #{chargeType},
			working_status = #{workingStatus},
			insurance_type = #{insuranceType},
			insurance_no = #{insuranceNo},
			service_agency = #{serviceAgency},
			mailing_address = #{mailingAddress},
			zip_code = #{zipCode},
			next_of_kin = #{nextOfKin},
			relationship = #{relationship},
			next_of_kin_addr = #{nextOfKinAddr},
			next_of_kin_zipcode = #{nextOfKinZipcode},
			next_of_kin_phone = #{nextOfKinPhone},
			patient_class = #{patientClass},
			admission_cause = #{admissionCause},
			consulting_date = #{consultingDate},
			pat_adm_condition = #{patAdmCondition},
			consulting_doctor = #{consultingDoctor},
			admitted_by = #{admittedBy},
			emer_treat_times = #{emerTreatTimes},
			esc_emer_times = #{escEmerTimes},
			serious_cond_days = #{seriousCondDays},
			critical_cond_days = #{criticalCondDays},
			icu_days = #{icuDays},
			ccu_days = #{ccuDays},
			spec_level_nurs_days = #{specLevelNursDays},
			first_level_nurs_days = #{firstLevelNursDays},
			second_level_nurs_days = #{secondLevelNursDays},
			autopsy_indicator = #{autopsyIndicator},
			blood_type = #{bloodType},
			blood_type_rh = #{bloodTypeRh},
			infusion_react_times = #{infusionReactTimes},
			blood_tran_times = #{bloodTranTimes},
			blood_tran_vol = #{bloodTranVol},
			blood_tran_react_times = #{bloodTranReactTimes},
			decubital_ulcer_times = #{decubitalUlcerTimes},
			alergy_drugs = #{alergyDrugs},
			adverse_reaction_drugs = #{adverseReactionDrugs},
			mr_value = #{mrValue},
			mr_quality = #{mrQuality},
			follow_indicator = #{followIndicator},
			follow_interval = #{followInterval},
			follow_interval_units = #{followIntervalUnits},
			director = #{director},
			attending_doctor = #{attendingDoctor},
			doctor_in_charge = #{doctorInCharge},
			discharge_disposition = #{dischargeDisposition},
			total_costs = #{totalCosts},
			total_payments = #{totalPayments},
			catalog_date = #{catalogDate},
			cataloger = #{cataloger},
			hbsag_indicator = #{hbsagIndicator},
			hcv_ab_indicator = #{hcvAbIndicator},
			hiv_ab_indicator = #{hivAbIndicator},
			chief_doctor = #{chiefDoctor},
			advanced_studies_doctor = #{advancedStudiesDoctor},
			practice_doctor_of_graduate = #{practiceDoctorOfGraduate},
			practice_doctor = #{practiceDoctor},
			doctor_of_control_quality = #{doctorOfControlQuality},
			nurse_of_control_quality = #{nurseOfControlQuality},
			date_of_control_quality = #{dateOfControlQuality},
			first_case_indicator = #{firstCaseIndicator},
			third_level_nurs_days = #{thirdLevelNursDays},
			x_exam_no = #{xExamNo},
			treated_in_others_indicator = #{treatedInOthersIndicator},
			treat_method = #{treatMethod},
			hosp_made_medicine_indicator = #{hospMadeMedicineIndicator},
			pathology_no = #{pathologyNo},
			upper_doctor_guide_effect = #{upperDoctorGuideEffect},
			emer_treat_method = #{emerTreatMethod},
			ictus_indicator = #{ictusIndicator},
			difficulty_indicator = #{difficultyIndicator},
			from_other_place_indicator = #{fromOtherPlaceIndicator},
			suspicion_indicator = #{suspicionIndicator},
			chinese_medicine_indicator = #{chineseMedicineIndicator},
			operation_scale = #{operationScale},
			diagnosis_correctness = #{diagnosisCorrectness},
			treat_method_correctness = #{treatMethodCorrectness},
			prescription_correctness = #{prescriptionCorrectness},
			mr_complete_indicator = #{mrCompleteIndicator},
			medical_term_correctness = #{medicalTermCorrectness},
			pper_doctor_guide_effect = #{pperDoctorGuideEffect},
			treat_method_judgement = #{treatMethodJudgement},
			duty_nurse = #{dutyNurse},
			death_reason = #{deathReason},
			death_date_time = #{deathDateTime},
			science_research_indicator = #{scienceResearchIndicator},
			first_operation_indicator = #{firstOperationIndicator},
			first_treatment_indicator = #{firstTreatmentIndicator},
			first_examination_indicator = #{firstExaminationIndicator},
			first_diagnosis_indicator = #{firstDiagnosisIndicator},
			infusion_react_indicator = #{infusionReactIndicator},
			serious_indicator = #{seriousIndicator},
			adt_room_no = #{adtRoomNo},
			ddt_room_no = #{ddtRoomNo},
			infect_indicator = #{infectIndicator},
			health_level = #{healthLevel},
			mr_infect_report = #{mrInfectReport},
			newborn = #{newborn},
			third_level_nurse_days = #{thirdLevelNurseDays},
			insurance_aera = #{insuranceAera},
			body_weight = #{bodyWeight},
			body_height = #{bodyHeight},
			business_zip_code = #{businessZipCode},
			infusion_tran_times = #{infusionTranTimes},
			change_indicator = #{changeIndicator},
			docum_date = #{documDate},
			docum_days = #{documDays},
			docum_person = #{documPerson},
			zymosis_indicator = #{zymosisIndicator},
			zymosis_date = #{zymosisDate},
			breath_mach_times = #{breathMachTimes},
			coma_times_b1 = #{comaTimesB1},
			coma_times_b2 = #{comaTimesB2},
			coma_times_a1 = #{comaTimesA1},
			coma_times_a2 = #{comaTimesA2},
			trans_hospital = #{transHospital},
			trans_community = #{transCommunity},
			phone_number_business = #{phoneNumberBusiness},
			mr_binder = #{mrBinder},
			carry_person_number = #{carryPersonNumber},
			change_operator = #{changeOperator},
			discharge_bed_no = #{dischargeBedNo},
			discharge_ward_code = #{dischargeWardCode},
			inp_serial_no = #{inpSerialNo},
			nhzyh = #{nhzyh},
			ff_xsdm = #{ffXsdm},
			trans_flag = #{transFlag},
			gz_flag = #{gzFlag},
			visit_date = #{visitDate},
			visit_no = #{visitNo},
			phone_number_home = #{phoneNumberHome},
			patient_area = #{patientArea},
			catalog_status = #{catalogStatus},
			locked_date = #{lockedDate},
			diagnose_date = #{diagnoseDate},
			medical_pay_way = #{medicalPayWay},
			statistics_diagnose_date = #{statisticsDiagnoseDate},
			docum_flag = #{documFlag},
			statistics_flag = #{statisticsFlag},
			weight_birth = #{weightBirth},
			coma_times_b0 = #{comaTimesB0},
			coma_times_a0 = #{comaTimesA0},
			patient_area_address = #{patientAreaAddress},
			pat_street_address = #{patStreetAddress},
			pat_phone = #{patPhone},
			pat_zip = #{patZip},
			plan_31_admission = #{plan31Admission},
			reason_31_admission = #{reason31Admission},
			tumor_t = #{tumorT},
			tumor_n = #{tumorN},
			tumor_m = #{tumorM},
			tumor_stage = #{tumorStage},
			adl_adm = #{adlAdm},
			adl_dis = #{adlDis},
			basis_on = #{basisOn},
			diff_id = #{diffId},
			locked_user = #{lockedUser},
			inp_no = #{inpNo},
			return_indicator = #{returnIndicator},
			pat_charge_type = #{patChargeType},
			operator = #{operator},
			enter_date = #{enterDate},
			parity_no = #{parityNo},
			onset_date = #{onsetDate},
			nh_serial_no = #{nhSerialNo},
			ip = #{ip},
			regist_attr = #{registAttr},
			visit_type = #{visitType},
			antibiotics_used = #{antibioticsUsed},
			antibiotics_count = #{antibioticsCount},
			antibiotics_union = #{antibioticsUnion},
			germiculture_drug_test = #{germicultureDrugTest},
			infectious_disease_report = #{infectiousDiseaseReport},
			blood_tran_flag = #{bloodTranFlag},
			drgs = #{drgs},
			admission_bed_no = #{admissionBedNo},
			newborn_inh_body_weight = #{newbornInhBodyWeight},
			newborn_body_weight = #{newbornBodyWeight},
			pof_flag = #{pofFlag},
			clinical_pathway = #{clinicalPathway},
			chinese_med_equipment = #{chineseMedEquipment},
			chinese_med_technology = #{chineseMedTechnology},
			dialectical_nursing = #{dialecticalNursing},
			yb_inp = #{ybInp},
			nhzz_type = #{nhzzType},
			update_by = #{updateBy.id},
			update_date = #{updateDate},
			remarks = #{remarks}
		WHERE id = #{id}
	</update>
	
	<update id="delete">
		UPDATE pat_visit SET 
			del_flag = #{DEL_FLAG_DELETE}
		WHERE id = #{id}
	</update>
	<select id="getPatientListInHos" resultType="com.jims.patient.Dto.PatientListDto">
		select
               b.patient_id as patientId,
               a.inp_no as inpNo,
               a.name as name,
               a.sex as sex,
               (trunc(sysdate) - trunc(d.admission_date_time)) as inpCount,
               d.admission_date_time as admissionDateTime,
               (case when b.dept_code_lend is null then b.dept_code else b.dept_code_lend end) as deptCode,
               a.date_of_birth as dataOfbith,
               d.attending_doctor as attendingDoctor,
               d.charge_type as chargeType,
               d.identity as patIdentity,
               nvl(b.PREPAYMENTS , 0) - nvl(b.TOTAL_CHARGES, 0) as prepayment,
               b.ward_code as wardCode
          from pat_master_index a,
               pats_in_hospital b,
		       bed_rec          c,
               pat_visit        d,
		       mr_on_line       e
         where a.id = b.patient_id
           and a.id = d.patient_id
		   and b.ward_code(+) = c.ward_code
		   and b.bed_no(+) = c.bed_no
		   and e.status = '0'
	       and (
	           (b.dept_code = #{deptCode} and b.dept_code_lend is null)
	              or (b.dept_code_lend = #{deptCode} and b.dept_code_lend is not null)
	           )
	           <if test="patName!=null and patName!='' ">
				   and  a.name=#{patName}
		       </if>
				<if test="startTime!=null and startTime!=''">
					<![CDATA[ and d.discharge_date_time >=  to_date(#{startTime}, 'yyyy-MM-dd') ]]>
				</if>
				<if test="endTime!=null and endTime!=''">
					<![CDATA[ and d.discharge_date_time <=  to_date(#{endTime}, 'yyyy-MM-dd') ]]>
				</if>
	</select>
	<select id="getPatientListOutHos" resultType="com.jims.patient.Dto.PatientListDto">
		select
		d.patient_id as patientId,
		'出院' as bedNo,
		a.inp_no as inpNo,
		a.name as name,
		a.sex as sex,
		(trunc(d.discharge_date_time) - trunc(d.admission_date_time)) as inpCount,
		d.admission_date_time as admissionDateTime,
		d.dept_discharge_from as deptCode,
		d.discharge_date_time as dischargeDateTime,
		a.date_of_birth as dataOfbith,
		d.charge_type as chargeType,
		d.identity as patIdentity,
		0 as prepayment,
		'出院' as ward_code
		from pat_master_index a , pat_visit d,mr_on_line e
		where a.id = d.patient_id
		and a.id=e.patient_id
		and e.status = '0'
		and d.dept_discharge_from = #{deptDischargeFrom}
		<if test="patName!=null and patName!='' ">
			and  a.name=#{patName}
		</if>
	</select>
	<select id="getPatientInformation" resultType="PatVisit">
		SELECT
		<include refid="patVisitColumns"/>,<include refid="getMaster"/>
		FROM
		<include refid="patVisitJoins"/>
		WHERE
		a.patient_id=#{patientId}
	</select>
	<update id="delVisit">
		update pat_visit set del_flag='1'
		<where>
			del_flag='0'
			<if test="patientId!=null and patientId!=''">
				and patient_id=#{patientId}
			</if>
			<if test="admissionDateTime!=null">
				and to_char(admission_date_time,'yyyy-MM-dd')=to_char(#{admissionDateTime},'yyyy-MM-dd')
			</if>
		</where>
	</update>
	<select id="getPatMaster" resultType="com.jims.patient.entity.PatMasterIndex">
				select
		       ID  AS id,
			   INP_NO AS inpNo,
			   SEX AS sex,
			   BED_NO AS bedNo,
			   DIAGNOSIS AS diagnosis,
			   DOCTOR_IN_CHARGE AS doctorInCharge,
			   NAME_PHONETIC AS namePhonetic,
			   DATE_OF_BIRTH AS dateOfBirth,
			   CHARGE_TYPE AS chargeType,
			   PATIENT_CONDITION AS patientCondition,
			   DEPT_CODE AS deptCode,
			   BED_LABEL AS bedLabel,
			   NAME AS name
				from
				(
				SELECT B.id,
					   B.INP_NO,
					   B.SEX,
					   A.BED_NO,
					   A.DIAGNOSIS,
					   A.DOCTOR_IN_CHARGE,
					   B.NAME_PHONETIC,
					   B.DATE_OF_BIRTH,
					   B.CHARGE_TYPE,
					   A.PATIENT_CONDITION,
					   (case when A.DEPT_CODE_LEND is null then A.DEPT_CODE else A.DEPT_CODE_LEND end) DEPT_CODE,
					   C.BED_LABEL,
					   B.NAME
				  FROM PAT_MASTER_INDEX B, PATS_IN_HOSPITAL A, BED_REC C
				 WHERE B.id = A.PATIENT_ID
				   and A.BED_NO = C.BED_NO
				   and A.WARD_CODE = C.WARD_CODE
				   and ((A.DEPT_CODE =#{deptCode} and A.DEPT_CODE_LEND is null) or
						(A.DEPT_CODE_LEND = #{deptCode} and A.DEPT_CODE_LEND is not null))
				  )
	</select>
	<select id="getPatMasterByIn" resultType="com.jims.patient.entity.PatMasterIndex">
		SELECT "MR_ON_LINE"."PATIENT_ID" AS id,
				 "PAT_MASTER_INDEX"."NAME" AS name,
				 "PAT_MASTER_INDEX"."SEX" AS sex,
				 "MR_ON_LINE"."STATUS" AS status,
				 "MR_ON_LINE"."REQUEST_DOCTOR_ID" AS requestDoctorId,
				 "MR_ON_LINE"."REQUEST_DATE_TIME" AS requestDateTime,
				 "PAT_MASTER_INDEX"."NAME_PHONETIC" AS namePhonetic,
				 "PAT_MASTER_INDEX"."DATE_OF_BIRTH" AS dateOfBirth,
				 "PAT_VISIT"."CHARGE_TYPE" AS chargeType,
					(select BED_label from bed_rec where ward_code=PATS_IN_HOSPITAL.ward_code and bed_no = PATS_IN_HOSPITAL.bed_no) bed_label ,
				 "PATS_IN_HOSPITAL"."DEPT_CODE" AS deptCode
			FROM "PAT_MASTER_INDEX",
					"PATS_IN_HOSPITAL" ,
				 "MR_ON_LINE",
				 "PAT_VISIT"
		   WHERE ( "MR_ON_LINE"."STATUS" = '*' ) And
					("PATS_IN_HOSPITAL"."WARD_CODE" IS NULL OR "PATS_IN_HOSPITAL"."WARD_CODE" in ('161102','161101','161102','161102','161101','161101','161102','161102') ) and
				 ("MR_ON_LINE"."PATIENT_ID"="PATS_IN_HOSPITAL"."PATIENT_ID") AND
				 ( "MR_ON_LINE"."PATIENT_ID" = "PAT_MASTER_INDEX"."ID"(+) ) and
				 ( "MR_ON_LINE"."PATIENT_ID" = "PAT_VISIT"."PATIENT_ID"(+))

		   union

			  SELECT "MR_ON_LINE"."PATIENT_ID",
						"PAT_MASTER_INDEX"."NAME",
						"PAT_MASTER_INDEX"."SEX",
						"MR_ON_LINE"."STATUS",
						"MR_ON_LINE"."REQUEST_DOCTOR_ID",
						"MR_ON_LINE"."REQUEST_DATE_TIME",
						"PAT_MASTER_INDEX"."NAME_PHONETIC",
						"PAT_MASTER_INDEX"."DATE_OF_BIRTH",
						"PAT_VISIT"."CHARGE_TYPE",
					(select BED_label from bed_rec where ward_code=PATS_IN_HOSPITAL.ward_code and bed_no = PATS_IN_HOSPITAL.bed_no) bed_label,
					"PATS_IN_HOSPITAL"."DEPT_CODE"
				 FROM "PAT_MASTER_INDEX",
						"PATS_IN_HOSPITAL" ,
						"MR_ON_LINE",
						"PAT_VISIT"
				WHERE ( "MR_ON_LINE"."STATUS" = '*' ) And
						("PATS_IN_HOSPITAL"."LEND_INDICATOR" = 1 AND "PATS_IN_HOSPITAL"."DEPT_CODE_LEND" IN ('140101','140102','140103','140104')) AND
						("MR_ON_LINE"."PATIENT_ID"="PATS_IN_HOSPITAL"."PATIENT_ID") AND
						( "MR_ON_LINE"."PATIENT_ID" = "PAT_MASTER_INDEX"."ID"(+) ) and
						( "MR_ON_LINE"."PATIENT_ID" = "PAT_VISIT"."PATIENT_ID"(+))


	</select>
    <update id="updatePatVisit">
		UPDATE "PAT_VISIT"
		   SET "PATIENT_AREA"          = #{patientArea},
			   "PATIENT_AREA_ADDRESS"  = #{patientAreaAddress},
			   "PAT_PHONE"             = #{patPhone},
			   "PAT_ZIP"               = #{patZip},
			   "PHONE_NUMBER_BUSINESS" = #{phoneNumberBusiness},
			   "BUSINESS_ZIP_CODE"     = #{businessZipCode},
			   "NEXT_OF_KIN"           = #{nextOfKin},
			   "RELATIONSHIP"          = #{relationship},
			   "NEXT_OF_KIN_ADDR"      = #{nextOfKinAddr},
			   "NEXT_OF_KIN_PHONE"     = #{nextOfKinPhone}
		 WHERE "ID" =#{id}

	</update>
	<select id="selectPatVisit" resultType="PatVisit">
		SELECT  * from PAT_VISIT WHERE
		<if test="id!=null and id!=''">
			id=#{id}
		</if>
	</select>
</mapper>